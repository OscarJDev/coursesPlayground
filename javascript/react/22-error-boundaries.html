<!DOCTYPE html>
<html>
  <head>
    <title>
     React ErrorBoundary Class Component
    </title>
  </head>
  <body>
    <div id="root"></div>
    <script src="https://unpkg.com/react@16.12.0/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@16.12.0/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone@7.8.3/babel.js"></script>
    <!-- Third party library on an ErrorBoundary component -->
    <script src="https://unpkg.com/react-error-boundary@1.2.5/dist/umd/react-error-boundary.js"></script>
    <script type="text/babel">
      
      class ErrorBoundary extends React.Component {
        state = {error:null}

        static getDerivedStateFromError(error) {
          console.log("From derivedState")
          return {error}
        }

        /* 
        We could also reset the state of both App and ErrorBoundary components in order to overcome from the error.

        Once the ErrorBoundary component is re-rendered with the fallback:
        
        componentDidUpdate(...prev) {
          console.log("From didUpdate: " + Boolean(this.state.error))
          if(Boolean(this.state.error)) {
            this.props.handleBomb(false)
            this.setState({error: null})
          }
        }
        */

        render () {
          const {error} = this.state
          console.log("From ErrorBoundary class " + Boolean(error))
          if (error) {
            return <this.props.FallbackComponent error={error} />
          }
          return this.props.children
        }
      }
      
      /* Using the react-error-boundary library requested (script) at the beginning */
      // const ErrorBoundary = ReactErrorBoundary.ErrorBoundary

      function ErrorFallback({error}) {
        return (
          <div>
            <p>Something Went Wrong!</p>
            <pre>{error.message}</pre>
          </div>
        )
      }

      function Bomb() {
        throw new Error("CABOOOOM!!!!")
      }

      function App() {
        const [bomb, setBomb] = React.useState(false)
        console.log("From App component " + bomb)
        return (
          <div>
            <div>
              <button onClick={()=> setBomb(bomb=>!bomb)}>
                Click me!
              </button>
            </div>
            <div>
              <ErrorBoundary handleBomb={setBomb} FallbackComponent={ErrorFallback}>
                {bomb ? <Bomb /> : "Push the button!" }
              </ErrorBoundary>
            </div>
          </div>
        )
      }

      ReactDOM.render(<App />, document.getElementById('root'))
    </script>
  </body>
</html>